{% extends 'base.html' %}

{% block title %}Pedidos de Empréstimo{% endblock %}

{% block content %}
<h2>Análise de Pedidos de Empréstimo Pendentes</h2>

<div class="table-responsive">
    <table class="table table-hover">
        <thead>
            <tr>
                <th>ID Pedido</th>
                <th>Cliente</th>
                <th>Data Pedido</th>
                <th>Valor</th>
                <th>Tipo</th>
                <th class="text-center">Risco de Default (Previsto)</th>
                <th class="text-end">Ações</th>
            </tr>
        </thead>
        <tbody>
            {% for pedido in pedidos %}
            <tr>
                <td>{{ pedido.PedidoId }}</td>
                <td><a href="{{ url_for('detalhe_cliente', id=pedido.cliente.ClienteId) }}">{{ pedido.cliente.Nome }}</a></td>
                <td>{{ pedido.DataPedido.strftime('%d-%m-%Y') }}</td>
                <td>€ {{ "%.2f"|format(pedido.Valor) }}</td>
                <td>{{ pedido.TipoEmprestimo.capitalize() }}</td>
                <td class="text-center">
                    {% set risco = pedido.ProbabilidadeDefault * 100 %}
                    <span class="badge 
                        {% if risco > 15 %} bg-danger
                        {% elif risco > 5 %} bg-warning
                        {% else %} bg-success
                        {% endif %}">
                        {{ "%.2f"|format(risco) }}%
                    </span>
                </td>
                <td class="text-end">
                    <form action="{{ url_for('processar_emprestimo', pedido_id=pedido.PedidoId, acao='aprovar') }}" method="POST" class="d-inline">
                        <button type="submit" class="btn btn-sm btn-success">Aprovar</button>
                    </form>
                    <form action="{{ url_for('processar_emprestimo', pedido_id=pedido.PedidoId, acao='rejeitar') }}" method="POST" class="d-inline">
                        <button type="submit" class="btn btn-sm btn-danger">Rejeitar</button>
                    </form>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="7" class="text-center">Não existem pedidos de empréstimo pendentes.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}